---
title: "[TIL]가비지 컬렉션"
excerpt: "자바스크립트 엔진이 어떻게 필요 없는 것들을 찾아내 삭제하는지 알아보자!"

categories:
  - TIL
tags:
  - [TIL]
published: true
toc: true
toc_sticky: true

date: 2022-07-15
last_modified_at: 2022-07-15
---

# 🌱 가비지 컬렉션

- JS는 눈에 보이지 않는 곳에서 메모리 관리를 함

- 우리가 만드는 모든 값은 메모리를 차지하는데, 그럼 쓸모 없게 된 것은 어떻게 처리 될까?

## 🌱 가비지 컬렉션 기준

- JS는 도달 가능한 값은 메모리에서 삭제되지 않음
  - 도달 가능한 값: 어떻게든 접근하거나 사용할 수 있는 값

1. 현재 함수의 지역 변수와 매개변수
2. 중첩 함수의 체인에 있는 함수에서 사용되는 변수와 매개변수
3. 전역 변수

위와 같은 값은 `루트(root)`라고 부르고 태생부터 도달 가능하므로 명백한 이유 없이 삭제되지 않음

1. 루트가 참조하는 값이나 체이닝으로 루트에서 참조할 수 있는 값은 도달 할 수있는 값임

## 🌱 참조 할 수 없는 경우 예시

![](/assets/image/garbage/참조할수없음.png)

- `family.fater`와 `family.mother.husband`를 삭제했기 때문에 도달 할 수 있는 방법이 없어서 `name: "john"`은 삭제됨
- 만약 위의 삭제된 두 개 중 하나만 삭제 되었으면 접근이 가능하므로 삭제되지 않음

## 🌱 내부 알고리즘

- 'mark-and-sweep'이라고 불리는 가비지 컬렉션 기본 알고리즘

1. 가비지컬렉터는 루트 정보를 수집하고 이를 mark(기억)함
2. 루트가 참조하고 있는 모든 객체 방문 및 mark.
3. mark된 모든 객체 방문 및 그 객체들이 참조하는 객체 mark 단, 한 번 방문한 객체는 전부 mark 하여 다시 방문❌
4. 루트에서 도달 가능한 모든 객체를 방문할때까지 위 과정 반복
5. mark 되지 않은 객체 삭제처리

## 🌱 최적화 기법

- JS 엔진은 실행에 영향을 미치지 않으면서 가비지 컬렉션을 더 빠르게 하는 다양한 `최적화 기법`을 적용

> Generational Collection(세대별 수집)

- 객체를 `새로운 객체`와 `오래된 객체`로 나눔
  - 새로운 객체 : 생성 이후 제 역할을 빠르게 수행해 금방 쓸모가 없어지는 객체
- 가비지컬렉터는 이런 `새로운 객체`를 공격적으로 메모리에서 제거
  - 반면 일정 시간 이상 살아남은 객체는 `오래된 객체`로 분류, 감시를 덜 함

> Incremental Collection(점진적 수집)

- 방문해야할 객체가 많으면 방문,mark 하는데 소요시간이 늘어남.
- 이를 해결하기 위해 가비지 컬렉션을 여러 부분으로 분리, 각 부분을 별도 수행함
- 장점: 긴 지연을 짧은 지연 여러개로 분산 시킬 수 있음

> Idle-Time Collection(유휴 시간 수집)

- 실행에 주는 영향을 최소화 하기 위해 CPU가 `유휴` 상태 일때만 실행함

# 참조

[JAVASCRIPT.INFO](https://ko.javascript.info/garbage-collection)
